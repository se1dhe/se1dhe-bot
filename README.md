# SE1DHE Bot

Telegram-бот для продажи ботов с административной панелью.

## Описание проекта

SE1DHE Bot - это комплексная платформа для продажи Telegram-ботов. Проект представляет собой экосистему, состоящую из Telegram-бота и административной панели, интегрированных с платежными системами.

Основные возможности платформы:
- Каталог ботов с разделением по категориям
- Корзина товаров с возможностью оформления заказа
- Поддержка скидок на отдельные боты и категории
- Многоязычный интерфейс (русский, украинский, английский)
- Система отзывов и баг-репортов
- Ченжлоги и система оповещений клиентов
- Административная панель с авторизацией через Telegram
- Интеграция с платежными системами FreeKassa и PayKassa

## Используемые технологии

- **Backend**: Python 3.12, aiogram 3, FastAPI
- **База данных**: MySQL (через SQLAlchemy и Alembic для миграций)
- **Админ-панель**: FastAPI + Jinja2 templates
- **Frontend (админка)**: Bootstrap, JQuery
- **Платежные системы**: Freekassa, PayKassa
- **API-интеграции**: Telegram API, Telegraph API
- **Контейнеризация**: Docker, docker-compose

## Структура проекта

```
se1dhe-bot/
├── admin/                  # Административная панель
│   ├── middleware/         # Middleware для админки
│   │   └── auth_middleware.py # Аутентификация
│   ├── routers/            # Маршруты админки
│   │   ├── auth.py         # Авторизация через Telegram
│   │   ├── bots.py         # Управление ботами
│   │   ├── changelogs.py   # Управление ченжлогами
│   │   ├── payments.py     # Управление платежами
│   │   ├── reports.py      # Управление баг-репортами
│   │   └── users.py        # Управление пользователями
│   ├── static/             # Статические файлы
│   │   └── css/            # CSS стили
│   ├── templates/          # Шаблоны HTML
│   │   ├── auth/           # Шаблоны авторизации
│   │   ├── bots/           # Шаблоны для управления ботами
│   │   ├── dashboard/      # Шаблоны дашборда
│   │   ├── payments/       # Шаблоны платежей
│   │   ├── reports/        # Шаблоны баг-репортов
│   │   └── users/          # Шаблоны пользователей
│   └── main.py             # Основной файл админки
│
├── alembic/                # Миграции базы данных
│   ├── versions/           # Версии миграций
│   └── env.py              # Настройки миграций
│
├── bot/                    # Telegram-бот
│   ├── handlers/           # Обработчики команд
│   │   ├── cart.py         # Корзина
│   │   ├── catalog.py      # Каталог
│   │   ├── help.py         # Справка
│   │   ├── menu.py         # Главное меню
│   │   ├── payment.py      # Обработка платежей
│   │   ├── settings.py     # Настройки
│   │   └── start.py        # Команда /start
│   ├── keyboards/          # Клавиатуры
│   │   └── main_menu.py    # Главное меню
│   ├── locales/            # Локализации
│   │   ├── en/             # Английский
│   │   ├── ru/             # Русский
│   │   └── uk/             # Украинский
│   ├── middlewares/        # Middleware для бота
│   │   └── i18n.py         # Интернационализация
│   ├── models/             # Модели данных для бота
│   └── main.py             # Основной файл бота
│
├── config/                 # Конфигурация проекта
│   ├── __init__.py
│   └── settings.py         # Настройки проекта
│
├── database/               # Работа с базой данных
│   ├── __init__.py
│   └── db.py               # Соединение с БД
│
├── docker/                 # Docker-конфигурация
│   └── Dockerfile          # Dockerfile
│
├── media/                  # Директория для медиа-файлов
│   ├── bot_files/          # Архивы ботов
│   └── bug_reports/        # Медиа баг-репортов
│
├── models/                 # Модели данных
│   ├── __init__.py
│   └── models.py           # SQLAlchemy модели
│
├── payments/               # Интеграция с платежными системами
│   ├── __init__.py
│   ├── freekassa.py        # FreeKassa интеграция
│   └── paykassa.py         # PayKassa интеграция
│
├── tests/                  # Тесты
│   ├── test_auth.py        # Тесты авторизации
│   ├── test_bot.py         # Тесты бота
│   └── test_payment.py     # Тесты платежей
│
├── utils/                  # Вспомогательные утилиты
│   ├── file_utils.py       # Работа с файлами
│   └── telegraph_utils.py  # Интеграция с Telegraph
│
├── .env                    # Переменные окружения (не хранить в репозитории)
├── .env.example            # Пример переменных окружения
├── .gitignore              # Игнорируемые файлы
├── alembic.ini             # Конфигурация Alembic
├── docker-compose.yml      # Docker Compose конфигурация
├── README.md               # Документация проекта
└── requirements.txt        # Зависимости проекта
```

## Установка и запуск

### Предварительные требования

- Python 3.12+
- Docker и Docker Compose (для запуска через контейнеры)
- MySQL (если запускаете без Docker)

### Установка через Docker (рекомендуется)

1. Клонируйте репозиторий:
```bash
git clone https://github.com/se1dhe/se1dhe-bot.git
cd se1dhe-bot
```

2. Создайте файл `.env` на основе `.env.example` и заполните его своими данными:
```bash
cp .env.example .env
# Отредактируйте .env файл с вашими настройками
```

3. Запустите проект с помощью Docker Compose:
```bash
docker-compose up -d
```

4. Проверьте, что все контейнеры запустились:
```bash
docker-compose ps
```

Теперь административная панель будет доступна по адресу http://localhost:8000, а Telegram-бот должен работать если вы правильно настроили BOT_TOKEN в .env файле.

### Запуск в режиме разработки

1. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv .venv
source .venv/bin/activate  # На Linux/Mac
# или
.venv\Scripts\activate  # На Windows
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте и настройте файл `.env`:
```bash
cp .env.example .env
# Отредактируйте .env файл с вашими настройками
```

4. Запустите MySQL (или используйте существующий сервер):
```bash
# Пример с Docker
docker run --name mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=se1dhe_bot -e MYSQL_USER=user -e MYSQL_PASSWORD=root -p 3306:3306 -d mysql:8.0
```

5. Выполните миграции базы данных:
```bash
alembic upgrade head
```

6. Запустите административную панель:
```bash
uvicorn admin.main:app --host 0.0.0.0 --port 8000 --reload
```

7. В отдельном терминале запустите Telegram-бота:
```bash
python -m bot.main
```

## Функциональность проекта

### Telegram-бот

#### Для пользователей:
- **Каталог ботов**: просмотр доступных ботов по категориям
- **Информация о ботах**: описание, цена, скидки, скриншоты
- **Корзина**: добавление ботов в корзину, изменение количества, удаление
- **Оформление заказа**: выбор способа оплаты, получение ссылки на оплату
- **Мои боты**: просмотр приобретенных ботов, скачивание архивов, чтение инструкций
- **Отзывы**: возможность оставить отзыв о приобретенном боте
- **Баг-репорты**: отправка сообщений об ошибках с приложением скриншотов/видео
- **Поддержка**: связь с администрацией
- **Настройки**: выбор языка интерфейса (русский, украинский, английский)

#### Для администраторов:
- **Управление каталогом**: добавление, редактирование, удаление ботов и категорий
- **Уведомления**: отправка уведомлений о новых версиях и обновлениях
- **Ответы на баг-репорты**: обработка сообщений от пользователей

### Административная панель

- **Дашборд**: общая статистика (пользователи, продажи, боты, баг-репорты)
- **Боты**: управление ботами и категориями
  - Добавление/редактирование ботов
  - Загрузка архивов и скриншотов
  - Создание инструкций через Telegraph
  - Управление скидками
- **Пользователи**: просмотр информации о пользователях
  - История покупок
  - Отзывы
  - Баг-репорты
- **Заказы**: управление заказами
  - Просмотр и изменение статуса заказов
  - Статистика продаж
- **Баг-репорты**: обработка сообщений о проблемах
  - Изменение статуса (новый, в работе, решен)
  - Просмотр приложенных медиафайлов
- **Ченжлоги**: ведение журнала изменений
  - Создание записей для ботов
  - Отправка уведомлений пользователям

## Платежные системы

Проект интегрирован с двумя платежными системами:

### FreeKassa
- Генерация ссылок для оплаты
- Обработка уведомлений о платежах
- Проверка статуса платежа

### PayKassa
- Работа через API
- Обработка webhook-уведомлений
- Проверка статуса платежа

## Разработка и расширение

### Добавление новой функциональности

1. Для бота:
   - Создайте новый обработчик в `bot/handlers/`
   - Зарегистрируйте его в `bot/handlers/__init__.py`
   - При необходимости добавьте новые клавиатуры в `bot/keyboards/`
   - Добавьте локализованные строки в JSON-файлы в `bot/locales/`

2. Для административной панели:
   - Создайте новый роутер в `admin/routers/`
   - Зарегистрируйте его в `admin/main.py`
   - Создайте необходимые шаблоны в `admin/templates/`

### Добавление новой платежной системы

1. Создайте новый файл в директории `payments/`
2. Реализуйте методы для:
   - Создания платежа
   - Обработки уведомлений
   - Проверки статуса платежа
3. Интегрируйте его в соответствующих обработчиках бота и админ-панели

## Тестирование

### Юнит-тесты
```bash
# Запуск всех тестов
python -m unittest discover tests

# Запуск конкретного теста
python -m unittest tests.test_auth
python -m unittest tests.test_payment
python -m unittest tests.test_bot
```

### Миграции базы данных
```bash
# Создание новой миграции
alembic revision --autogenerate -m "описание_миграции"

# Применение всех миграций
alembic upgrade head

# Откат на предыдущую версию
alembic downgrade -1
```

## Безопасность

- Все API-ключи и токены хранятся в файле `.env` (не входит в репозиторий)
- Доступ к административной панели только через авторизацию Telegram
- Только пользователи из списка ADMIN_IDS имеют доступ к админке
- JWT-токены используются для авторизации в административной панели
- Валидация входящих данных для предотвращения атак
- Защита от SQL-инъекций через ORM (SQLAlchemy)

## Лицензия

[MIT](LICENSE)

## Авторы

- se1dhe
- t.me/se1dhe